<!DOCTYPE html>
<!-- saved from url=(0043)https://aes.cryptohack.org/flipping_cookie/ -->
<html lang="en" dir="ltr" class="dark-mode"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Flipping Cookie</title>
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/tomorrow-night.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/atom-one-light.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/materialize.min.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/main.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/light.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/main-ac.css">
  <link rel="stylesheet" type="text/css" href="./Flipping Cookie_files/v4-shims.min.css">
  <script src="./Flipping Cookie_files/highlight.min.js.download" type="text/javascript"></script><link type="text/css" rel="stylesheet" id="dark-mode-custom-link"><link type="text/css" rel="stylesheet" id="dark-mode-general-link"><style lang="en" type="text/css" id="dark-mode-custom-style"></style><style lang="en" type="text/css" id="dark-mode-native-style"></style><style lang="en" type="text/css" id="dark-mode-native-sheet"></style>
  <script src="./Flipping Cookie_files/jquery.min.js.download" type="text/javascript"></script>
  <script src="./Flipping Cookie_files/materialize.min.js.download" type="text/javascript"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <link rel="apple-touch-icon" sizes="57x57" href="https://aes.cryptohack.org/static/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://aes.cryptohack.org/static/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://aes.cryptohack.org/static/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://aes.cryptohack.org/static/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://aes.cryptohack.org/static/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://aes.cryptohack.org/static/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://aes.cryptohack.org/static/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://aes.cryptohack.org/static/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://aes.cryptohack.org/static/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="36x36" href="https://aes.cryptohack.org/static/favicon/android-icon-36x36.png">
  <link rel="icon" type="image/png" sizes="48x48" href="https://aes.cryptohack.org/static/favicon/android-icon-48x48.png">
  <link rel="icon" type="image/png" sizes="72x72" href="https://aes.cryptohack.org/static/favicon/android-icon-72x72.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://aes.cryptohack.org/static/favicon/android-icon-96x96.png">
  <link rel="icon" type="image/png" sizes="144x144" href="https://aes.cryptohack.org/static/favicon/android-icon-144x144.png">
  <link rel="icon" type="image/png" sizes="192x192" href="https://aes.cryptohack.org/static/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://aes.cryptohack.org/static/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://aes.cryptohack.org/static/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://aes.cryptohack.org/static/favicon/favicon-16x16.png">

  <script>
    function isLightThemeSelected() {
        return document.cookie.match(/theme=light/i) != null
    }

    function setThemeFromCookie() {
        var html = document.getElementsByTagName('html')[0]
        html.className = isLightThemeSelected() ? 'light-mode' : 'dark-mode'

        if(isLightThemeSelected()){
          document.styleSheets[0].disabled = true
        }
        else{
          document.styleSheets[1].disabled = true
        }

        console.log('Loaded cookie: ' + document.cookie)
    }

    (function() {
      setThemeFromCookie()
    })();
  </script>


  <script>
    $(function() { 
      $('#check_admin').submit(function() {
        url = "/flipping_cookie/check_admin/"
        params = ['cookie', 'iv'];
        for (i = 0; i < params.length; i++) {
          url += $("#check_admin ." + params[i]).val();
          url += "/";
        }
        $.get(
          url,
          function(data) {
            $("#results").text(JSON.stringify(data));
          }
        );
        return false;
      })
    
      $('#get_cookie').submit(function() {
        url = "/flipping_cookie/get_cookie/"
        params = [];
        for (i = 0; i < params.length; i++) {
          url += $("#get_cookie ." + params[i]).val();
          url += "/";
        }
        $.get(
          url,
          function(data) {
            $("#results").text(JSON.stringify(data));
          }
        );
        return false;
      })
    
      function toHex(str) {
        try {
          hex = unescape(encodeURIComponent(str))
            .split('').map(function(v){
              return v.charCodeAt(0).toString(16)
            }).join('')
        } catch(e) {
          hex = str
          console.log('invalid text input: ' + str)
        }
        return hex
      }

      function fromHex(hex) {
        try{
          str = decodeURIComponent(hex.replace(/(..)/g,'%$1'))
        }
        catch(e) {
          console.log('invalid hex input: ' + hex)
          return "[unprintable]"
        }
        return str
      }

      $('#fromText').bind('input propertychange', function() {
        var fromLen = $('#fromText').val().length;
        $('#fromLen').text(fromLen);

        var hex = toHex($('#fromText').val());
        $('#toText').val(hex);
        Materialize.updateTextFields($('#toText'));

        var toLen = $('#toText').val().length;
        $('#toLen').text(toLen);
      });

      $('#toText').bind('input propertychange', function() {
        var toLen = $('#toText').val().length;
        $('#toLen').text(toLen);

        var hex = $('#toText').val();
        if (hex.length % 2 == 0)  {
          var text = fromHex(hex);
          $('#fromText').val(text);
          Materialize.updateTextFields($('#fromText'));
        }

        var fromLen = $('#fromText').val().length;
        $('#fromLen').text(fromLen);
      });


      function xorhex(a, b) {
        if (a.length > b.length) {
          a = a.substring(0, b.length);
        } else {
          b = b.substring(0, a.length);
        }
        var res = "";
        var i = a.length;
        while (i-->0)
          res = (parseInt(a.charAt(i), 16) ^ parseInt(b.charAt(i), 16)).toString(16) + res;
        return res;
      }


      $('#xor1,#xor2').bind('input propertychange', function() {
        if ( $('#xor1,#xor2').hasClass( "invalid" ) ) {
          return
        }
        var a = $('#xor1').val();
        var b = $('#xor2').val();
        var res = xorhex(a, b);
        $('#xorResult').text(res);
      });

    })
  </script>
</head>
<body cz-shortcut-listen="true">
<header>
  <a href="https://cryptohack.org/">CRYPTOHACK</a>
</header>

<main>
  <h1>Flipping Cookie</h1>

  <div class="largeFlex">
    <div class="sourceWrap">
      <h5>Description</h5>

      <p>You can get a cookie for my website, but it won't help you read the flag... I think.</p>

      <h5>Help</h5>

      <p>This page offers a convenient way for you to interact with the challenge functions. You can also use GET requests to send and receive data directly from the listed routes/endpoints if you wish. For more information see the <a href="https://cryptohack.org/faq#blockciphers">FAQ</a>.</p>
      <p>Your aim is to recover the <code>FLAG</code> value. Once you have it, submit it on the <a href="https://cryptohack.org/challenges/aes">CryptoHack Symmetric Ciphers page</a>.</p>
    </div>

    <div class="challengeWrap">
      <div class="diagramContainer">
          <img class="svgDiagram" src="./Flipping Cookie_files/CBC_decryption.svg" alt="">
      </div>
    </div>

  </div>

  <div class="largeFlex">
    <div class="sourceWrap">
      <h4>Source</h4>
      <pre class="sourceBlock"><code class="python hljs"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta


KEY = ?
FLAG = ?


<span class="hljs-meta">@chal.route('/flipping_cookie/check_admin/&lt;cookie&gt;/&lt;iv&gt;/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_admin</span><span class="hljs-params">(cookie, iv)</span>:</span>
    cookie = bytes.fromhex(cookie)
    iv = bytes.fromhex(iv)

    <span class="hljs-keyword">try</span>:
        cipher = AES.new(KEY, AES.MODE_CBC, iv)
        decrypted = cipher.decrypt(cookie)
        unpadded = unpad(decrypted, <span class="hljs-number">16</span>)
    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: str(e)}

    <span class="hljs-keyword">if</span> <span class="hljs-string">b"admin=True"</span> <span class="hljs-keyword">in</span> unpadded.split(<span class="hljs-string">b";"</span>):
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"flag"</span>: FLAG}
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"Only admin can read the flag"</span>}


<span class="hljs-meta">@chal.route('/flipping_cookie/get_cookie/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_cookie</span><span class="hljs-params">()</span>:</span>
    expires_at = (datetime.today() + timedelta(days=<span class="hljs-number">1</span>)).strftime(<span class="hljs-string">"%s"</span>)
    cookie = <span class="hljs-string">f"admin=False;expiry=<span class="hljs-subst">{expires_at}</span>"</span>.encode()

    iv = os.urandom(<span class="hljs-number">16</span>)
    padded = pad(cookie, <span class="hljs-number">16</span>)
    cipher = AES.new(KEY, AES.MODE_CBC, iv)
    encrypted = cipher.encrypt(padded)
    ciphertext = iv.hex() + encrypted.hex()

    <span class="hljs-keyword">return</span> {<span class="hljs-string">"cookie"</span>: ciphertext}


</code></pre>
    </div>

    <div class="challengeWrap">
      <h4>Interact</h4>
      <div class="row card challenge-card">
      
        
          <!-- <div class="row card challenge-card"> -->
            <h5 class="functionName">check_admin(cookie,iv)</h5>
            <form class="col s12" id="check_admin" action="https://aes.cryptohack.org/flipping_cookie/#" spellcheck="false" autocomplete="off">
            
              <div class="row">
                <div class="input-field col s12">
                  <input type="text" class="hexinput cookie">
                  <label for="cookie">cookie</label>
                  <span class="helper-text">Hex Input Only</span>
                </div>
              </div>
            
              <div class="row">
                <div class="input-field col s12">
                  <input type="text" class="hexinput iv">
                  <label for="iv">iv</label>
                  <span class="helper-text">Hex Input Only</span>
                </div>
              </div>
            
            <div class="col m12 s12 challenge-button"><button class="waves-effect waves-light btn" type="submit" value="Submit">Submit</button></div>
            </form>
          <!-- </div> -->
        
      
        
          <!-- <div class="row card challenge-card"> -->
            <h5 class="functionName">get_cookie()</h5>
            <form class="col s12" id="get_cookie" action="https://aes.cryptohack.org/flipping_cookie/#">
            <div class="col m12 s12 challenge-button-only"><button class="waves-effect waves-light btn" type="submit" value="Submit">Submit</button></div>
            </form>
          <!-- </div> -->
        
      
    </div>
      <div class="card results">
        <h5 class="functionName">Output</h5>
        <p id="results"></p>
      </div>
    </div>
  </div>


  <div class="largeFlex">
    <div class="challengeWrap">
      <div class="convertForm card">
        <h5 class="coral-text">XOR tool</h5>
        <p>Use this form to XOR two hex strings together.</p>

        <div class="row">
          <form id="encoder" action="https://aes.cryptohack.org/flipping_cookie/#" spellcheck="false" class="col s12 formFix">
            <div class="col s12 m6 formFix">
              <div class="input-field col s12">
                <textarea id="xor1" class="materialize-textarea hexinput"></textarea>
                <label for="xor1">Enter hex here</label>
              </div>
            </div>

            <div class="col s12 m6 formFix">
              <div class="input-field col s12">
                <textarea id="xor2" class="materialize-textarea hexinput"></textarea>
                <label for="xor2">Enter hex here</label>
              </div>
            </div>
          </form>
        </div>

        <div class="row">
          <h6 class="coral-text">Output</h6>
          <div class="col s12 m12" id="xorResult">
          </div>
        </div>
      </div>
    </div>

    <div class="sourceWrap">
      <div class="convertForm card">
        <h5 class="coral-text">Hex Encoder/Decoder</h5>

        <p>This is a convenient encoder designed for ASCII &lt;-&gt; Hex translations. It won't work for decoding hex to byte streams and will just show <code>[unprintable]</code> in that case.</p>

        <div class="row">
          <form id="encoder" action="https://aes.cryptohack.org/flipping_cookie/#" spellcheck="false" class="col s12 formFix">
            <div class="col s12 m6 formFix">
              <div class="input-field col s12">
                <textarea id="toText" class="materialize-textarea hexinput"></textarea>
                <label for="toText">Enter hex here</label>
              </div>
            </div>

            <div class="col s12 m6 formFix">
              <div class="input-field col s12">
                <textarea id="fromText" class="materialize-textarea"></textarea>
                <label for="fromText">Enter text here</label>
                <div class="chr-counter"><span id="fromLen" class="coral-text">0</span></div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


    
  
</main>


<footer>
<div class="footerLinks">
  <div>
    <h5>CryptoHack</h5>
    <a id="changeTheme">Light Mode</a><br>
    <a href="https://cryptohack.org/">CryptoHack</a><br>
    <a href="https://cryptohack.org/faq/">FAQ</a><br>
    <a href="https://blog.cryptohack.org/">Blog</a><br>
    <span class="footerIcon">
      <a href="https://twitter.com/cryptohack__"><i class="fab fa-twitter"></i></a>
      <a href="https://cryptohack.org/chat/"><img src="./Flipping Cookie_files/Discord-Logo-Color.svg" width="25" style="padding-bottom: 10px;"></a>
      <a href="https://www.patreon.com/cryptohack" aria-label="Patreon"><i class="fab fa-patreon"></i></a>
    </span><br>
  </div>

  <div>
    <h5>Courses</h5>
    <a href="https://cryptohack.org/courses/intro/course_details/">Introduction to CryptoHack</a><br>
    <a href="https://cryptohack.org/courses/modular/course_details/">Modular Arithmetic</a><br>
    <a href="https://cryptohack.org/courses/symmetric/course_details/">Symmetric Cryptography</a><br>
    <a href="https://cryptohack.org/courses/public-key/course_details/">Public-Key Cryptography</a><br>
    <a href="https://cryptohack.org/courses/elliptic/course_details/">Elliptic Curves</a><br>
  </div>

  <div>
    <h5>Categories</h5>
    <a href="https://cryptohack.org/challenges/general/">General</a><br>
    <a href="https://cryptohack.org/challenges/aes/">Symmetric Ciphers</a><br>
    <a href="https://cryptohack.org/challenges/maths/">Mathematics</a><br>
    <a href="https://cryptohack.org/challenges/rsa/">RSA</a><br>
    <a href="https://cryptohack.org/challenges/diffie-hellman/">Diffie-Hellman</a><br>
    <a href="https://cryptohack.org/challenges/ecc/">Elliptic Curves</a><br>
    <a href="https://cryptohack.org/challenges/hashes/">Hash Functions</a><br>
    <a href="https://cryptohack.org/challenges/web/">Crypto on the Web</a><br>
    <a href="https://cryptohack.org/challenges/post-quantum/">Lattices</a><br>
    <a href="https://cryptohack.org/challenges/isogenies/">Isogenies</a><br>
    <a href="https://cryptohack.org/challenges/zkp/">Zero-Knowledge Proofs</a><br>
    <a href="https://cryptohack.org/challenges/misc/">Miscellaneous</a><br>
    <a href="https://cryptohack.org/challenges/ctf-archive/">CTF Archive</a><br>
  </div>

</div>


<div class="credits">
  <h5>Credits</h5>
  Illustrations from <a href="https://icons8.com/">Ouch.pics</a><br>
  Drawn by <a href="https://dribbble.com/thierryfousse">Thierry Fousse</a> and  <a href="https://icons8.com/illustrations/author/60ab64bc8e3740e9be238b13">Tatyana Krasutskaya</a>
</div>

<div class="copyright">
  <span>
  </span>
</div>
</footer>



<script type="text/javascript">
$(document).ready(function() {
  $('select').material_select();
});
</script>

<script>
  function updateThemeToggleFooter() {
    var elem = document.querySelector('#changeTheme');
    elem.innerHTML = isLightThemeSelected() ? 'Dark Mode' : 'Light Mode'
  }

  (function() {
    updateThemeToggleFooter()
  })();

  function togglePageContentLightDark() {
      var html = document.getElementsByTagName('html')[0]
      var currentClass = html.className
      var newClass = html.className == 'dark-mode' ? 'light-mode' : 'dark-mode'
      html.className = newClass

      document.cookie = 'theme=' + (newClass == 'light-mode' ? 'light' : 'dark') + '; SameSite=Strict; path=/; domain=cryptohack.org; expires=Fri, 31 Dec 9999 23:59:59 GMT'
      console.log('Cookies are now: ' + document.cookie)

      updateThemeToggleFooter()
  }

  $("#changeTheme").on("click", function(e){
    if(isLightThemeSelected()){
      document.styleSheets[0].disabled = false
      document.styleSheets[1].disabled = true
    }
    else{
      document.styleSheets[0].disabled = true
      document.styleSheets[1].disabled = false
    }
    togglePageContentLightDark()
  });
</script>

<div class="hiddendiv common"></div></body></html>